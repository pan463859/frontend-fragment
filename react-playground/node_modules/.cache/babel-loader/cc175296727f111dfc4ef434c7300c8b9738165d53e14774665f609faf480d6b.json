{"ast":null,"code":"var _jsxFileName = \"/Users/panan/workspace/react-playground/src/virtualList/FixedSizeList.jsx\",\n  _s = $RefreshSig$();\nimport { useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst FixedSizeList = props => {\n  _s();\n  const {\n    height,\n    width,\n    itemSize,\n    itemCount,\n    children: Child\n  } = props;\n  // 记录滚动掉的高度\n  const [scrollOffset, setScrollOffset] = useState(0);\n\n  // 外部容器高度\n  const containerStyle = {\n    position: 'relative',\n    width,\n    height,\n    overflow: 'auto'\n  };\n\n  // 1000个元素撑起盒子的实际高度\n  const contentStyle = {\n    height: itemSize * itemCount,\n    width: '100%'\n  };\n  const getCurrentChildren = () => {\n    // 可视区起始索引\n    const startIndex = Math.floor(scrollOffset / itemSize);\n    // 上缓冲区起始索引\n    const finialStartIndex = Math.max(0, startIndex - 2);\n    // 可视区能展示的元素的最大个数\n    const numVisible = Math.ceil(height / itemSize);\n    // 下缓冲区结束索引\n    const endIndex = Math.min(itemCount - 1, startIndex + numVisible + 2);\n    const items = [];\n    // 根据上面计算的索引值，不断添加元素给container\n    for (let i = finialStartIndex; i < endIndex; i++) {\n      const itemStyle = {\n        position: 'absolute',\n        height: itemSize,\n        width: '100%',\n        // 计算每个元素在container中的top值\n        top: itemSize * i\n      };\n      items.push( /*#__PURE__*/_jsxDEV(Child, {\n        index: i,\n        style: itemStyle\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 9\n      }, this));\n    }\n    return items;\n  };\n\n  // 当触发滚动就重新计算\n  const scrollHandle = event => {\n    const {\n      scrollTop\n    } = event.currentTarget;\n    setScrollOffset(scrollTop);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: containerStyle,\n    onScroll: scrollHandle,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: contentStyle,\n      children: getCurrentChildren()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 8\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 5\n  }, this);\n};\n_s(FixedSizeList, \"4tukcjN0NGSiltGM/U+g14q21tQ=\");\n_c = FixedSizeList;\nconst rowSizes = new Array(1000).fill(true).map(() => 25 + Math.round(Math.random() * 55));\nconst getItemSize = index => rowSizes[index];\nconst Row = _ref => {\n  let {\n    index,\n    style\n  } = _ref;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: index % 2 ? 'list-item-odd' : 'list-item-even',\n    style: style,\n    children: [\"Row \", index]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 5\n  }, this);\n};\n_c2 = Row;\nconst _FixedSizeList = () => {\n  return /*#__PURE__*/_jsxDEV(VariableSizeList, {\n    className: \"list\",\n    height: 200,\n    width: 200,\n    itemSize: getItemSize,\n    itemCount: 1000,\n    children: Row\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 77,\n    columnNumber: 5\n  }, this);\n};\nexport default _FixedSizeList;\nvar _c, _c2;\n$RefreshReg$(_c, \"FixedSizeList\");\n$RefreshReg$(_c2, \"Row\");","map":{"version":3,"names":["useState","jsxDEV","_jsxDEV","FixedSizeList","props","_s","height","width","itemSize","itemCount","children","Child","scrollOffset","setScrollOffset","containerStyle","position","overflow","contentStyle","getCurrentChildren","startIndex","Math","floor","finialStartIndex","max","numVisible","ceil","endIndex","min","items","i","itemStyle","top","push","index","style","fileName","_jsxFileName","lineNumber","columnNumber","scrollHandle","event","scrollTop","currentTarget","onScroll","_c","rowSizes","Array","fill","map","round","random","getItemSize","Row","_ref","className","_c2","_FixedSizeList","VariableSizeList","$RefreshReg$"],"sources":["/Users/panan/workspace/react-playground/src/virtualList/FixedSizeList.jsx"],"sourcesContent":["import { useState } from 'react';\n\nconst FixedSizeList = (props) => {\n  const { height, width, itemSize, itemCount, children: Child } = props;\n  // 记录滚动掉的高度\n  const [scrollOffset, setScrollOffset] = useState(0);\n\n  // 外部容器高度\n  const containerStyle = {\n    position: 'relative',\n    width,\n    height,\n    overflow: 'auto',\n  };\n\n  // 1000个元素撑起盒子的实际高度\n  const contentStyle = {\n    height: itemSize * itemCount,\n    width: '100%',\n  };\n    \n  const getCurrentChildren = () => {\n    // 可视区起始索引\n    const startIndex = Math.floor(scrollOffset / itemSize);\n    // 上缓冲区起始索引\n    const finialStartIndex = Math.max(0, startIndex - 2);\n    // 可视区能展示的元素的最大个数\n    const numVisible = Math.ceil(height / itemSize);\n    // 下缓冲区结束索引\n    const endIndex = Math.min(itemCount - 1, startIndex + numVisible + 2);\n    const items = [];\n    // 根据上面计算的索引值，不断添加元素给container\n    for (let i = finialStartIndex; i < endIndex; i++) {\n      const itemStyle = {\n        position: 'absolute',\n        height: itemSize,\n        width: '100%',\n        // 计算每个元素在container中的top值\n        top: itemSize * i,\n      };\n      items.push(\n        <Child key={i} index={i} style={itemStyle} />\n      );\n    }\n    return items;\n  }\n\n  // 当触发滚动就重新计算\n  const scrollHandle = (event) => {\n    const { scrollTop } = event.currentTarget;\n    setScrollOffset(scrollTop);\n  }\n\n  return (\n    <div style={containerStyle} onScroll={scrollHandle}>\n       <div style={contentStyle}>\n          {getCurrentChildren()}\n       </div>\n    </div>\n  );\n};\n\n\nconst rowSizes = new Array(1000).fill(true).map(() => 25 + Math.round(Math.random() * 55))\nconst getItemSize = (index) => rowSizes[index];\n\nconst Row = ({ index, style }) => {\n  return (\n    <div className={index % 2 ? 'list-item-odd' : 'list-item-even'} style={style} >\n      Row {index}\n    </div>\n  )\n}\n\nconst _FixedSizeList = () => {\n  return (\n    <VariableSizeList\n      className=\"list\"\n      height={200}\n      width={200}\n      itemSize={getItemSize}\n      itemCount={1000}\n    >\n      {Row}\n    </VariableSizeList>\n  );\n}\n\nexport default _FixedSizeList;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}