{"ast":null,"code":"var _jsxFileName = \"/Users/panan/workspace/react-playground/src/virtualList/VirtualList.jsx\",\n  _s = $RefreshSig$();\nimport { useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst _FixedSizeList = props => {\n  _s();\n  const {\n    height,\n    width,\n    itemSize,\n    itemCount,\n    children: Child\n  } = props;\n  // 记录滚动掉的高度\n  const [scrollOffset, setScrollOffset] = useState(0);\n\n  // 外部容器高度\n  const containerStyle = {\n    position: 'relative',\n    width,\n    height,\n    overflow: 'auto'\n  };\n\n  // 1000个元素撑起盒子的实际高度\n  const contentStyle = {\n    height: itemSize * itemCount,\n    width: '100%'\n  };\n  const getCurrentChildren = () => {\n    // 可视区起始索引\n    const startIndex = Math.floor(scrollOffset / itemSize);\n    // 上缓冲区起始索引\n    const finialStartIndex = Math.max(0, startIndex - 2);\n    // 可视区能展示的元素的最大个数\n    const numVisible = Math.ceil(height / itemSize);\n    // 下缓冲区结束索引\n    const endIndex = Math.min(itemCount - 1, startIndex + numVisible + 2);\n    const items = [];\n    // 根据上面计算的索引值，不断添加元素给container\n    for (let i = finialStartIndex; i < endIndex; i++) {\n      const itemStyle = {\n        position: 'absolute',\n        height: itemSize,\n        width: '100%',\n        // 计算每个元素在container中的top值\n        top: itemSize * i\n      };\n      items.push( /*#__PURE__*/_jsxDEV(Child, {\n        index: i,\n        style: itemStyle\n      }, i, false, {\n        fileName: _jsxFileName,\n        lineNumber: 42,\n        columnNumber: 9\n      }, this));\n    }\n    return items;\n  };\n\n  // 当触发滚动就重新计算\n  const scrollHandle = event => {\n    const {\n      scrollTop\n    } = event.currentTarget;\n    setScrollOffset(scrollTop);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: containerStyle,\n    onScroll: scrollHandle,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      style: contentStyle,\n      children: getCurrentChildren()\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 56,\n      columnNumber: 8\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 55,\n    columnNumber: 5\n  }, this);\n};\n_s(_FixedSizeList, \"4tukcjN0NGSiltGM/U+g14q21tQ=\");\nconst Row = _ref => {\n  let {\n    index,\n    style,\n    forwardRef\n  } = _ref;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: index % 2 ? 'list-item-odd' : 'list-item-even',\n    style: style,\n    ref: forwardRef,\n    children: `Row ${index}`\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 7\n  }, this);\n};\n_c = Row;\nconst FixedSizeList = () => {\n  return /*#__PURE__*/_jsxDEV(FixedSizeList, {\n    className: \"list\",\n    height: 200,\n    width: 200,\n    itemSize: 50,\n    itemCount: 1000,\n    children: Row\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 7\n  }, this);\n};\n_c2 = FixedSizeList;\nexport default FixedSizeList;\nvar _c, _c2;\n$RefreshReg$(_c, \"Row\");\n$RefreshReg$(_c2, \"FixedSizeList\");","map":{"version":3,"names":["useState","jsxDEV","_jsxDEV","_FixedSizeList","props","_s","height","width","itemSize","itemCount","children","Child","scrollOffset","setScrollOffset","containerStyle","position","overflow","contentStyle","getCurrentChildren","startIndex","Math","floor","finialStartIndex","max","numVisible","ceil","endIndex","min","items","i","itemStyle","top","push","index","style","fileName","_jsxFileName","lineNumber","columnNumber","scrollHandle","event","scrollTop","currentTarget","onScroll","Row","_ref","forwardRef","className","ref","_c","FixedSizeList","_c2","$RefreshReg$"],"sources":["/Users/panan/workspace/react-playground/src/virtualList/VirtualList.jsx"],"sourcesContent":["import { useState } from 'react';\n\nconst _FixedSizeList = (props) => {\n  const { height, width, itemSize, itemCount, children: Child } = props;\n  // 记录滚动掉的高度\n  const [scrollOffset, setScrollOffset] = useState(0);\n\n  // 外部容器高度\n  const containerStyle = {\n    position: 'relative',\n    width,\n    height,\n    overflow: 'auto',\n  };\n\n  // 1000个元素撑起盒子的实际高度\n  const contentStyle = {\n    height: itemSize * itemCount,\n    width: '100%',\n  };\n    \n  const getCurrentChildren = () => {\n    // 可视区起始索引\n    const startIndex = Math.floor(scrollOffset / itemSize);\n    // 上缓冲区起始索引\n    const finialStartIndex = Math.max(0, startIndex - 2);\n    // 可视区能展示的元素的最大个数\n    const numVisible = Math.ceil(height / itemSize);\n    // 下缓冲区结束索引\n    const endIndex = Math.min(itemCount - 1, startIndex + numVisible + 2);\n    const items = [];\n    // 根据上面计算的索引值，不断添加元素给container\n    for (let i = finialStartIndex; i < endIndex; i++) {\n      const itemStyle = {\n        position: 'absolute',\n        height: itemSize,\n        width: '100%',\n        // 计算每个元素在container中的top值\n        top: itemSize * i,\n      };\n      items.push(\n        <Child key={i} index={i} style={itemStyle} />\n      );\n    }\n    return items;\n  }\n\n  // 当触发滚动就重新计算\n  const scrollHandle = (event) => {\n    const { scrollTop } = event.currentTarget;\n    setScrollOffset(scrollTop);\n  }\n\n  return (\n    <div style={containerStyle} onScroll={scrollHandle}>\n       <div style={contentStyle}>\n          {getCurrentChildren()}\n       </div>\n    </div>\n  );\n};\nconst Row = ({ index, style, forwardRef }) => {\n    return (\n      <div className={index % 2 ? 'list-item-odd' : 'list-item-even'} style={style} ref={forwardRef}>\n        {`Row ${index}`}\n      </div>\n    )\n  }\n  \n  const FixedSizeList = () => {\n    return (\n      <FixedSizeList\n        className=\"list\"\n        height={200}\n        width={200}\n        itemSize={50}\n        itemCount={1000}\n      >\n        {Row}\n      </FixedSizeList>\n    );\n  }\n  \nexport default FixedSizeList;\n"],"mappings":";;AAAA,SAASA,QAAQ,QAAQ,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEjC,MAAMC,cAAc,GAAIC,KAAK,IAAK;EAAAC,EAAA;EAChC,MAAM;IAAEC,MAAM;IAAEC,KAAK;IAAEC,QAAQ;IAAEC,SAAS;IAAEC,QAAQ,EAAEC;EAAM,CAAC,GAAGP,KAAK;EACrE;EACA,MAAM,CAACQ,YAAY,EAAEC,eAAe,CAAC,GAAGb,QAAQ,CAAC,CAAC,CAAC;;EAEnD;EACA,MAAMc,cAAc,GAAG;IACrBC,QAAQ,EAAE,UAAU;IACpBR,KAAK;IACLD,MAAM;IACNU,QAAQ,EAAE;EACZ,CAAC;;EAED;EACA,MAAMC,YAAY,GAAG;IACnBX,MAAM,EAAEE,QAAQ,GAAGC,SAAS;IAC5BF,KAAK,EAAE;EACT,CAAC;EAED,MAAMW,kBAAkB,GAAGA,CAAA,KAAM;IAC/B;IACA,MAAMC,UAAU,GAAGC,IAAI,CAACC,KAAK,CAACT,YAAY,GAAGJ,QAAQ,CAAC;IACtD;IACA,MAAMc,gBAAgB,GAAGF,IAAI,CAACG,GAAG,CAAC,CAAC,EAAEJ,UAAU,GAAG,CAAC,CAAC;IACpD;IACA,MAAMK,UAAU,GAAGJ,IAAI,CAACK,IAAI,CAACnB,MAAM,GAAGE,QAAQ,CAAC;IAC/C;IACA,MAAMkB,QAAQ,GAAGN,IAAI,CAACO,GAAG,CAAClB,SAAS,GAAG,CAAC,EAAEU,UAAU,GAAGK,UAAU,GAAG,CAAC,CAAC;IACrE,MAAMI,KAAK,GAAG,EAAE;IAChB;IACA,KAAK,IAAIC,CAAC,GAAGP,gBAAgB,EAAEO,CAAC,GAAGH,QAAQ,EAAEG,CAAC,EAAE,EAAE;MAChD,MAAMC,SAAS,GAAG;QAChBf,QAAQ,EAAE,UAAU;QACpBT,MAAM,EAAEE,QAAQ;QAChBD,KAAK,EAAE,MAAM;QACb;QACAwB,GAAG,EAAEvB,QAAQ,GAAGqB;MAClB,CAAC;MACDD,KAAK,CAACI,IAAI,eACR9B,OAAA,CAACS,KAAK;QAASsB,KAAK,EAAEJ,CAAE;QAACK,KAAK,EAAEJ;MAAU,GAA9BD,CAAC;QAAAM,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAA+B,CAC9C,CAAC;IACH;IACA,OAAOV,KAAK;EACd,CAAC;;EAED;EACA,MAAMW,YAAY,GAAIC,KAAK,IAAK;IAC9B,MAAM;MAAEC;IAAU,CAAC,GAAGD,KAAK,CAACE,aAAa;IACzC7B,eAAe,CAAC4B,SAAS,CAAC;EAC5B,CAAC;EAED,oBACEvC,OAAA;IAAKgC,KAAK,EAAEpB,cAAe;IAAC6B,QAAQ,EAAEJ,YAAa;IAAA7B,QAAA,eAChDR,OAAA;MAAKgC,KAAK,EAAEjB,YAAa;MAAAP,QAAA,EACrBQ,kBAAkB,CAAC;IAAC;MAAAiB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACnB;EAAC;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACJ,CAAC;AAEV,CAAC;AAACjC,EAAA,CA1DIF,cAAc;AA2DpB,MAAMyC,GAAG,GAAGC,IAAA,IAAkC;EAAA,IAAjC;IAAEZ,KAAK;IAAEC,KAAK;IAAEY;EAAW,CAAC,GAAAD,IAAA;EACrC,oBACE3C,OAAA;IAAK6C,SAAS,EAAEd,KAAK,GAAG,CAAC,GAAG,eAAe,GAAG,gBAAiB;IAACC,KAAK,EAAEA,KAAM;IAACc,GAAG,EAAEF,UAAW;IAAApC,QAAA,EAC1F,OAAMuB,KAAM;EAAC;IAAAE,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACZ,CAAC;AAEV,CAAC;AAAAW,EAAA,GANGL,GAAG;AAQP,MAAMM,aAAa,GAAGA,CAAA,KAAM;EAC1B,oBACEhD,OAAA,CAACgD,aAAa;IACZH,SAAS,EAAC,MAAM;IAChBzC,MAAM,EAAE,GAAI;IACZC,KAAK,EAAE,GAAI;IACXC,QAAQ,EAAE,EAAG;IACbC,SAAS,EAAE,IAAK;IAAAC,QAAA,EAEfkC;EAAG;IAAAT,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACS,CAAC;AAEpB,CAAC;AAAAa,GAAA,GAZKD,aAAa;AAcrB,eAAeA,aAAa;AAAC,IAAAD,EAAA,EAAAE,GAAA;AAAAC,YAAA,CAAAH,EAAA;AAAAG,YAAA,CAAAD,GAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}